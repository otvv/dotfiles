#!/bin/bash

THUMB_DIR=~/.cache/wofi_wallpapers
mkdir -p "$THUMB_DIR"

# get the wallpaper folder
WALLPAPER_DIR="$(xdg-user-dir PICTURES)/Wallpapers"

# create a selection menu with the preview of all images found
CHOICE=$(ls "$WALLPAPER_DIR" | wofi --dmenu --width 500 --no-line-numbers --hide-search --height 400 --cache-file=/dev/null)

# if user made a selection, set the wallpaper using hyprpaper
if [ -n "$CHOICE" ]; then

    WALLPAPER_PATH="$WALLPAPER_DIR/$CHOICE"

    sed -i "/^preload =/d" ~/.config/hypr/hyprpaper.conf
    sed -i "/^wallpaper =/d" ~/.config/hypr/hyprpaper.conf
    echo "preload = $WALLPAPER_PATH" >> ~/.config/hypr/hyprpaper.conf
    echo "wallpaper = , $WALLPAPER_PATH" >> ~/.config/hypr/hyprpaper.conf
    
    # check if theres a hyprpaper instance running
    # and reload
    if pgrep -x "hyprpaper" > /dev/null; then
        pkill hyprpaper
        hyprpaper &
    else
        hyprpaper & # reload wallpaper if hyprpaper is closed
    fi
fi

